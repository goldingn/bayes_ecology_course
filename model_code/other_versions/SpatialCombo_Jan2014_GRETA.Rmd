Mick's spatially-correlated fire model

```{r bugs_model}
bugs_code <- "
model
{

  mSlope <- mean(Slope[])

  aa ~ dnorm(0, 1.0E-6)

  b[1] ~ dnorm(0, 1.0E-6)
  b[2] ~ dnorm(0, 1.0E-6)
  b[3] ~ dnorm(0, 1.0E-6)
  b[4] ~ dnorm(0, 1.0E-6)
  b[5] ~ dnorm(0, 1.0E-6)

  # mix of KE and PP data, first 114 points are KE; assume PP sites are independent of KE sites
  for (i in 1:633)  {
    mu[i] <- aa + b[1] * (1/(Age[i]/100) - 1/0.2) + b[2]  * (1/(Age[i]/100) - 1/0.2) * (1/(Age[i]/100) - 1/0.2) + b[3] * (Slope[i]-mSlope) + b[4]*CosA[i] + b[5] * (Slope[i]-mSlope) * CosA[i] 
    zero[i] <- 0
  }

  tau <- 1
  phi ~ dunif(0.0, 20)   
  kappa <- 1

  z[1:114] ~ spatial.exp(zero[1:114], X[1:114], Y[1:114], tau, phi, kappa)
  z[115:633] ~ spatial.exp(zero[115:633], X[115:633], Y[115:633], tau, phi, kappa)

  for (i in 1:633) {
    d[i] <- step(z[i] + mu[i])
    CF[i] ~ dbern(d[i])
  }

  at <- aa + b[2] / 0.04 - b[1] / 0.2
  bt <- b[1] - 2 * b[2] / 0.2
  t_of_maxp <- -2 * b[2] / bt

  for (i in 1:300) {
    probitp[i] <- aa + b[1] * (1 / (i / 100) - 1 / 0.2) + b[2] * (1 / (i / 100) - 1 / 0.2) * (1 / (i / 100) - 1 / 0.2) 
    p[i] <- phi(probitp[i])
  }
}
"
```

```{r data}
data <- list(
  X = c(333.18392, 334.68392, 336.68392, 334.68392, 334.88392, 
        334.98392, 337.08392, 337.08392, 337.18392, 336.98392, 337.18392, 
        336.68392, 337.08392, 337.08392, 336.18392, 336.88392, 336.78392, 
        335.68392, 335.68392, 335.68392, 336.88392, 336.78392, 335.58392, 
        336.88392, 335.48392, 336.08392, 336.78392, 335.48392, 336.88392, 
        336.98392, 336.88392, 334.78392, 335.78392, 340.38392, 339.48392, 
        345.38392, 337.88392, 337.78392, 337.38392, 336.78392, 339.98392, 
        340.08392, 339.78392, 337.28392, 336.58392, 339.98392, 337.68392, 
        340.28392, 340.08392, 335.98392, 336.38392, 335.88392, 336.58392, 
        336.48392, 335.58392, 337.38392, 335.38392, 335.58392, 337.68392, 
        336.78392, 339.08392, 343.08392, 342.18392, 338.98392, 341.38392, 
        342.48392, 341.88392, 340.28392, 344.08392, 337.38392, 339.98392, 
        341.98392, 340.58392, 341.58392, 339.78392, 340.78392, 342.48392, 
        342.38392, 339.78392, 340.28392, 341.08392, 339.78392, 339.98392, 
        338.98392, 343.68392, 338.58392, 339.38392, 339.88392, 340.98392, 
        339.38392, 340.18392, 339.48392, 338.38392, 343.68392, 346.48392, 
        343.58392, 346.28392, 346.08392, 346.18392, 346.08392, 343.28392, 
        346.18392, 343.38392, 346.08392, 345.98392, 346.38392, 345.88392, 
        343.18392, 346.18392, 342.08392, 342.38392, 342.98392, 342.58392, 
        346.48392, 389.78392, 389.88392, 391.68392, 390.28392, 389.68392, 
        386.88392, 389.58392, 389.88392, 391.68392, 389.48392, 391.58392, 
        391.68392, 387.48392, 388.88392, 389.78392, 389.68392, 389.78392, 
        389.88392, 389.28392, 387.58392, 389.88392, 387.48392, 390.28392, 
        390.38392, 389.88392, 391.68392, 391.58392, 391.78392, 389.38392, 
        389.98392, 389.98392, 390.48392, 390.88392, 390.18392, 388.58392, 
        390.58392, 389.98392, 390.38392, 390.68392, 390.88392, 390.48392, 
        390.48392, 390.78392, 390.78392, 390.18392, 390.68392, 389.98392, 
        388.98392, 389.88392, 390.58392, 387.28392, 390.08392, 390.68392, 
        389.88392, 390.18392, 389.98392, 390.48392, 387.08392, 389.78392, 
        387.88392, 390.28392, 391.28392, 387.58392, 391.08392, 389.38392, 
        389.38392, 388.98392, 391.08392, 391.38392, 387.78392, 387.88392, 
        390.98392, 391.08392, 387.88392, 391.28392, 391.08392, 391.18392, 
        389.48392, 391.18392, 391.08392, 390.28392, 391.08392, 391.18392, 
        390.98392, 391.98392, 387.88392, 387.58392, 388.48392, 392.38392, 
        392.18392, 391.58392, 388.68392, 392.18392, 388.78392, 388.28392, 
        391.58392, 392.88392, 391.88392, 387.48392, 391.88392, 392.38392, 
        387.98392, 390.68392, 387.48392, 387.78392, 386.68392, 387.38392, 
        388.58392, 392.08392, 390.98392, 388.48392, 388.58392, 388.78392, 
        392.38392, 392.08392, 389.18392, 390.68392, 390.08392, 388.78392, 
        389.68392, 390.58392, 390.18392, 390.28392, 389.78392, 389.18392, 
        392.58392, 389.88392, 388.68392, 388.78392, 388.68392, 391.68392, 
        390.28392, 389.08392, 388.98392, 389.48392, 389.88392, 390.18392, 
        391.08392, 391.18392, 390.58392, 391.18392, 390.98392, 390.68392, 
        390.58392, 387.38392, 391.58392, 392.18392, 392.58392, 391.68392, 
        391.68392, 392.58392, 392.48392, 392.48392, 392.28392, 391.88392, 
        391.48392, 391.68392, 386.68392, 392.28392, 392.58392, 392.08392, 
        391.68392, 391.68392, 391.68392, 387.48392, 387.68392, 391.58392, 
        392.38392, 392.18392, 391.68392, 392.28392, 391.48392, 386.88392, 
        392.08392, 392.18392, 392.38392, 392.38392, 392.48392, 392.28392, 
        392.58392, 392.28392, 392.28392, 392.48392, 392.28392, 392.28392, 
        392.18392, 392.48392, 392.18392, 392.38392, 392.28392, 392.48392, 
        392.48392, 392.38392, 392.58392, 392.38392, 392.28392, 387.68392, 
        387.68392, 392.08392, 393.78392, 391.98392, 391.18392, 393.88392, 
        391.98392, 392.78392, 391.38392, 392.28392, 391.48392, 392.18392, 
        390.78392, 392.48392, 390.58392, 392.88392, 390.88392, 391.58392, 
        391.98392, 394.28392, 391.28392, 392.68392, 393.38392, 391.78392, 
        393.38392, 391.78392, 393.28392, 390.48392, 391.28392, 393.48392, 
        392.68392, 394.78392, 392.98392, 394.78392, 393.78392, 394.28392, 
        393.78392, 393.18392, 393.28392, 386.68392, 393.18392, 387.38392, 
        392.98392, 393.28392, 393.18392, 393.28392, 387.28392, 393.18392, 
        393.88392, 393.28392, 393.48392, 393.68392, 392.88392, 386.48392, 
        394.28392, 386.58392, 387.28392, 393.18392, 393.28392, 398.58392, 
        398.38392, 398.48392, 398.58392, 398.58392, 392.58392, 398.48392, 
        393.78392, 393.78392, 399.18392, 392.58392, 399.28392, 393.08392, 
        393.18392, 392.78392, 392.68392, 393.18392, 393.08392, 394.08392, 
        398.78392, 398.68392, 393.98392, 393.88392, 392.78392, 393.68392, 
        392.88392, 398.68392, 398.38392, 392.68392, 399.28392, 393.28392, 
        392.78392, 393.28392, 392.98392, 393.48392, 393.38392, 392.98392, 
        393.48392, 393.48392, 392.88392, 393.28392, 393.58392, 393.58392, 
        393.28392, 392.98392, 392.78392, 392.88392, 393.38392, 392.98392, 
        392.88392, 392.98392, 393.08392, 393.58392, 393.38392, 393.48392, 
        392.88392, 393.38392, 393.48392, 393.68392, 392.98392, 393.98392, 
        394.88392, 393.98392, 393.78392, 393.88392, 394.18392, 394.78392, 
        394.98392, 393.98392, 393.88392, 393.98392, 394.78392, 395.28392, 
        394.08392, 398.58392, 397.58392, 397.28392, 397.38392, 396.78392, 
        394.58392, 394.48392, 394.48392, 397.18392, 397.78392, 396.28392, 
        393.68392, 396.28392, 392.98392, 397.28392, 393.08392, 398.18392, 
        386.48392, 396.88392, 393.68392, 397.78392, 397.88392, 395.98392, 
        398.28392, 397.08392, 398.18392, 394.18392, 395.08392, 393.58392, 
        394.38392, 395.88392, 397.28392, 396.08392, 395.78392, 394.08392, 
        394.48392, 397.48392, 393.88392, 397.58392, 391.78392, 393.98392, 
        394.38392, 395.48392, 394.48392, 393.98392, 394.58392, 396.08392, 
        395.18392, 396.48392, 394.18392, 395.38392, 395.68392, 393.98392, 
        393.38392, 394.28392, 396.18392, 393.48392, 388.48392, 393.98392, 
        393.48392, 393.88392, 387.58392, 387.58392, 388.28392, 393.58392, 
        388.38392, 387.58392, 386.78392, 387.58392, 387.68392, 387.58392, 
        393.58392, 393.58392, 393.38392, 393.38392, 387.58392, 394.68392, 
        386.88392, 388.38392, 388.38392, 394.78392, 386.68392, 399.78392, 
        399.78392, 399.08392, 394.38392, 399.18392, 393.78392, 393.98392, 
        399.88392, 393.88392, 394.78392, 394.78392, 399.18392, 399.68392, 
        393.88392, 394.78392, 399.88392, 393.98392, 387.68392, 399.58392, 
        399.48392, 394.18392, 395.18392, 399.38392, 394.58392, 394.98392, 
        394.68392, 394.88392, 395.28392, 394.88392, 399.28392, 395.18392, 
        399.28392, 394.48392, 394.98392, 394.98392, 394.48392, 395.08392, 
        394.98392, 395.18392, 399.28392, 394.78392, 394.68392, 394.38392, 
        394.98392, 399.38392, 399.28392, 394.58392, 399.08392, 398.28392, 
        400.98392, 394.98392, 398.68392, 400.28392, 398.68392, 398.98392, 
        399.08392, 400.38392, 398.58392, 387.58392, 395.08392, 394.08392, 
        401.38392, 394.68392, 401.18392, 397.48392, 401.28392, 400.88392, 
        401.18392, 399.18392, 395.98392, 401.28392, 388.18392, 401.28392, 
        395.08392, 387.48392, 400.88392, 401.68392, 395.38392, 396.38392, 
        395.58392, 396.38392, 396.38392, 398.08392, 397.98392, 395.68392, 
        396.28392, 396.48392, 395.68392, 395.68392, 397.28392, 395.08392, 
        395.78392, 397.98392, 395.58392, 396.08392, 397.28392, 395.78392, 
        396.28392, 395.98392, 396.18392, 397.88392, 396.98392, 395.68392, 
        396.08392, 395.98392, 395.18392, 396.18392),
  Y = c(5857.15903, 
        5858.25903, 5857.75903, 5858.15903, 5858.15903, 5858.65903, 5858.15903, 
        5858.05903, 5857.85903, 5857.75903, 5857.95903, 5859.15903, 5857.75903, 
        5857.85903, 5859.65903, 5857.85903, 5857.75903, 5860.25903, 5860.45903, 
        5860.35903, 5858.25903, 5857.85903, 5860.85903, 5857.75903, 5859.25903, 
        5860.15903, 5857.95903, 5859.35903, 5858.05903, 5858.15903, 5857.95903, 
        5860.85903, 5860.55903, 5860.75903, 5858.65903, 5859.55903, 5859.65903, 
        5859.65903, 5858.05903, 5859.25903, 5858.85903, 5858.55903, 5858.75903, 
        5858.25903, 5859.55903, 5860.35903, 5858.45903, 5858.55903, 5860.65903, 
        5859.95903, 5859.65903, 5859.55903, 5859.65903, 5859.55903, 5859.35903, 
        5858.25903, 5860.75903, 5859.65903, 5858.05903, 5858.05903, 5858.85903, 
        5856.55903, 5857.75903, 5854.85903, 5855.15903, 5855.85903, 5855.45903, 
        5855.05903, 5858.95903, 5857.25903, 5856.25903, 5855.15903, 5854.25903, 
        5857.35903, 5854.55903, 5854.95903, 5856.15903, 5856.05903, 5858.45903, 
        5853.75903, 5858.65903, 5856.55903, 5858.05903, 5855.05903, 5858.55903, 
        5857.25903, 5858.15903, 5855.55903, 5855.95903, 5858.05903, 5858.35903, 
        5856.05903, 5857.25903, 5861.25903, 5860.45903, 5861.15903, 5860.95903, 
        5859.25903, 5860.95903, 5861.35903, 5860.75903, 5861.05903, 5860.85903, 
        5861.25903, 5859.25903, 5860.45903, 5859.25903, 5860.75903, 5861.15903, 
        5858.95903, 5858.85903, 5858.35903, 5859.05903, 5859.45903, 5843.55903, 
        5843.65903, 5842.95903, 5843.45903, 5842.25903, 5840.15903, 5842.15903, 
        5842.05903, 5842.55903, 5842.15903, 5842.55903, 5842.65903, 5839.65903, 
        5845.35903, 5842.25903, 5842.35903, 5843.65903, 5843.45903, 5843.55903, 
        5839.65903, 5842.15903, 5839.55903, 5843.25903, 5843.15903, 5841.75903, 
        5842.85903, 5842.35903, 5842.85903, 5843.55903, 5841.85903, 5844.25903, 
        5842.85903, 5843.55903, 5844.45903, 5844.25903, 5842.95903, 5844.35903, 
        5843.55903, 5842.95903, 5843.05903, 5843.05903, 5843.35903, 5843.35903, 
        5843.55903, 5844.55903, 5843.25903, 5844.05903, 5843.85903, 5844.55903, 
        5843.25903, 5839.65903, 5844.25903, 5843.35903, 5844.15903, 5844.35903, 
        5843.95903, 5843.25903, 5839.85903, 5844.05903, 5838.95903, 5840.85903, 
        5842.45903, 5839.95903, 5842.55903, 5842.75903, 5842.55903, 5843.65903, 
        5842.65903, 5843.05903, 5838.85903, 5838.75903, 5842.95903, 5842.85903, 
        5838.85903, 5842.55903, 5843.15903, 5843.15903, 5842.65903, 5842.45903, 
        5842.75903, 5840.95903, 5842.95903, 5843.55903, 5843.35903, 5837.25903, 
        5838.35903, 5840.45903, 5838.45903, 5837.05903, 5837.25903, 5837.65903, 
        5838.55903, 5837.65903, 5838.45903, 5839.95903, 5836.85903, 5837.65903, 
        5837.45903, 5840.05903, 5837.55903, 5836.95903, 5838.15903, 5840.95903, 
        5840.25903, 5838.15903, 5840.25903, 5840.45903, 5839.95903, 5837.85903, 
        5840.75903, 5839.95903, 5838.65903, 5838.65903, 5837.65903, 5837.95903, 
        5839.55903, 5838.35903, 5839.55903, 5839.65903, 5839.05903, 5838.55903, 
        5838.55903, 5838.55903, 5838.25903, 5839.25903, 5837.15903, 5839.65903, 
        5839.95903, 5839.05903, 5839.05903, 5837.95903, 5838.45903, 5839.85903, 
        5839.85903, 5839.75903, 5839.35903, 5840.25903, 5840.65903, 5837.65903, 
        5838.45903, 5840.75903, 5838.15903, 5837.95903, 5837.75903, 5839.35903, 
        5842.15903, 5843.55903, 5843.85903, 5841.75903, 5841.85903, 5843.75903, 
        5844.05903, 5843.95903, 5843.65903, 5842.85903, 5841.95903, 5842.15903, 
        5840.05903, 5843.75903, 5843.95903, 5843.85903, 5841.95903, 5842.05903, 
        5842.25903, 5839.35903, 5838.65903, 5842.25903, 5844.05903, 5843.75903, 
        5842.45903, 5844.25903, 5842.15903, 5840.05903, 5844.05903, 5844.55903, 
        5843.45903, 5844.65903, 5843.55903, 5843.15903, 5842.95903, 5843.25903, 
        5844.55903, 5843.65903, 5843.55903, 5844.75903, 5844.65903, 5843.75903, 
        5843.15903, 5843.25903, 5844.85903, 5843.05903, 5844.75903, 5842.85903, 
        5843.25903, 5843.75903, 5844.65903, 5838.45903, 5839.05903, 5841.45903, 
        5846.05903, 5841.75903, 5842.25903, 5845.75903, 5841.85903, 5839.65903, 
        5839.75903, 5839.35903, 5840.45903, 5841.05903, 5838.65903, 5840.15903, 
        5839.65903, 5840.05903, 5840.25903, 5840.35903, 5839.95903, 5838.55903, 
        5839.85903, 5840.25903, 5839.85903, 5839.55903, 5838.25903, 5841.05903, 
        5840.35903, 5840.05903, 5840.65903, 5844.05903, 5843.95903, 5841.95903, 
        5842.75903, 5842.05903, 5843.85903, 5842.35903, 5843.95903, 5843.15903, 
        5843.05903, 5839.95903, 5844.05903, 5839.15903, 5842.85903, 5844.15903, 
        5843.25903, 5842.85903, 5839.15903, 5842.95903, 5843.95903, 5844.05903, 
        5843.35903, 5844.35903, 5842.75903, 5839.85903, 5842.25903, 5839.85903, 
        5839.35903, 5842.75903, 5843.15903, 5839.45903, 5839.25903, 5839.15903, 
        5839.35903, 5839.15903, 5842.75903, 5839.55903, 5842.75903, 5842.65903, 
        5840.05903, 5844.35903, 5840.05903, 5844.45903, 5844.15903, 5844.45903, 
        5844.55903, 5844.35903, 5844.55903, 5842.75903, 5839.25903, 5839.45903, 
        5842.85903, 5842.75903, 5844.65903, 5842.75903, 5844.45903, 5838.95903, 
        5839.65903, 5844.65903, 5839.95903, 5842.25903, 5843.35903, 5842.55903, 
        5843.25903, 5842.55903, 5842.35903, 5843.15903, 5842.15903, 5842.45903, 
        5843.15903, 5842.45903, 5842.55903, 5842.45903, 5842.65903, 5843.05903, 
        5843.55903, 5843.45903, 5842.55903, 5843.35903, 5843.35903, 5842.95903, 
        5842.95903, 5842.25903, 5842.45903, 5842.35903, 5843.05903, 5842.25903, 
        5842.25903, 5842.35903, 5843.45903, 5844.05903, 5844.85903, 5844.55903, 
        5844.35903, 5844.45903, 5844.65903, 5844.35903, 5844.95903, 5844.15903, 
        5844.15903, 5844.75903, 5844.45903, 5844.95903, 5844.65903, 5837.95903, 
        5837.85903, 5837.95903, 5837.45903, 5836.65903, 5841.75903, 5842.15903, 
        5836.65903, 5838.15903, 5837.85903, 5839.75903, 5842.15903, 5839.45903, 
        5836.55903, 5837.65903, 5843.35903, 5837.45903, 5839.75903, 5838.35903, 
        5836.75903, 5837.45903, 5837.45903, 5838.95903, 5839.35903, 5837.85903, 
        5837.75903, 5837.85903, 5839.75903, 5841.85903, 5839.85903, 5836.35903, 
        5836.65903, 5838.05903, 5836.55903, 5839.35903, 5838.75903, 5836.75903, 
        5840.35903, 5836.75903, 5838.35903, 5841.15903, 5836.85903, 5837.25903, 
        5841.05903, 5838.75903, 5840.75903, 5836.75903, 5839.45903, 5837.85903, 
        5841.05903, 5839.65903, 5838.85903, 5837.85903, 5838.95903, 5839.45903, 
        5840.15903, 5843.25903, 5837.15903, 5843.85903, 5843.15903, 5843.85903, 
        5838.85903, 5838.95903, 5837.15903, 5843.25903, 5837.35903, 5838.65903, 
        5839.95903, 5839.15903, 5838.85903, 5838.75903, 5843.15903, 5843.35903, 
        5842.85903, 5843.05903, 5839.05903, 5842.45903, 5839.95903, 5837.05903, 
        5837.15903, 5842.35903, 5839.85903, 5840.55903, 5840.45903, 5840.15903, 
        5842.75903, 5840.15903, 5842.95903, 5843.05903, 5840.55903, 5842.95903, 
        5842.55903, 5842.45903, 5840.25903, 5840.55903, 5843.05903, 5842.65903, 
        5840.45903, 5842.95903, 5838.95903, 5837.85903, 5837.75903, 5843.55903, 
        5844.25903, 5837.75903, 5843.95903, 5842.65903, 5844.05903, 5843.85903, 
        5844.15903, 5844.25903, 5837.75903, 5843.95903, 5837.35903, 5844.05903, 
        5844.35903, 5843.85903, 5843.95903, 5844.35903, 5843.95903, 5842.65903, 
        5837.15903, 5844.15903, 5844.15903, 5844.05903, 5844.15903, 5837.35903, 
        5837.25903, 5844.05903, 5837.35903, 5839.85903, 5839.95903, 5842.15903, 
        5837.35903, 5839.25903, 5836.95903, 5837.35903, 5837.15903, 5839.45903, 
        5837.35903, 5838.45903, 5844.65903, 5843.45903, 5840.25903, 5843.85903, 
        5838.85903, 5840.35903, 5839.55903, 5839.55903, 5839.95903, 5837.25903, 
        5841.65903, 5840.65903, 5836.85903, 5839.95903, 5844.05903, 5837.75903, 
        5839.05903, 5839.85903, 5840.65903, 5840.15903, 5835.95903, 5840.95903, 
        5841.15903, 5836.55903, 5836.45903, 5840.75903, 5840.05903, 5840.65903, 
        5841.25903, 5840.65903, 5836.35903, 5841.55903, 5835.85903, 5836.65903, 
        5840.65903, 5836.05903, 5836.25903, 5841.15903, 5840.25903, 5841.15903, 
        5840.65903, 5836.35903, 5839.85903, 5835.85903, 5835.85903, 5835.75903, 
        5841.55903, 5835.85903),
  Age = c(13, 21, 20, 21, 21, 22, 12, 
          12, 12, 12, 12, 13, 12, 12, 19, 20, 20, 19, 19, 19, 20, 20, 19, 
          20, 24, 23, 20, 24, 20, 20, 20, 26, 25, 26, 26, 26, 26, 26, 26, 
          26, 26, 26, 26, 26, 25, 26, 40, 26, 26, 26, 26, 26, 25, 26, 26, 
          26, 26, 26, 26, 26, 26, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 
          70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 300, 
          300, 300, 300, 300, 300, 300, 300, 26, 26, 26, 26, 26, 26, 26, 
          26, 26, 26, 26, 26, 26, 26, 26, 26, 70, 70, 70, 70, 26, 7, 7, 
          5, 9, 6, 5, 6, 6, 5, 6, 5, 5, 5, 7, 6, 6, 7, 7, 8, 9, 6, 5, 9, 
          9, 6, 5, 5, 5, 9, 6, 13, 12, 11, 13, 13, 12, 13, 10, 12, 12, 
          12, 11, 10, 10, 13, 12, 13, 13, 13, 12, 10, 13, 10, 13, 13, 13, 
          10, 10, 13, 18, 19, 20, 16, 20, 15, 15, 15, 20, 20, 18, 17, 19, 
          20, 18, 20, 18, 18, 15, 20, 20, 19, 20, 18, 18, 70, 70, 70, 70, 
          70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 
          70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 300, 300, 300, 300, 300, 
          300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 
          300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 6, 
          7, 8, 8, 7, 7, 8, 8, 8, 8, 5, 7, 7, 5, 8, 8, 8, 7, 7, 7, 6, 6, 
          7, 8, 8, 5, 8, 7, 5, 8, 10, 11, 10, 11, 11, 11, 11, 10, 11, 11, 
          10, 10, 11, 11, 11, 10, 11, 11, 11, 11, 11, 10, 17, 18, 70, 70, 
          70, 70, 70, 70, 300, 300, 300, 300, 300, 300, 300, 300, 300, 
          300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 
          9, 8, 5, 5, 5, 9, 5, 9, 6, 6, 5, 9, 6, 5, 9, 6, 6, 6, 6, 9, 9, 
          6, 9, 5, 5, 5, 5, 6, 6, 6, 10, 10, 10, 10, 10, 11, 10, 11, 11, 
          10, 10, 10, 11, 11, 11, 11, 11, 11, 11, 10, 10, 11, 11, 11, 11, 
          11, 10, 10, 11, 10, 18, 17, 18, 17, 18, 18, 17, 18, 18, 17, 18, 
          18, 18, 18, 17, 17, 17, 18, 17, 17, 17, 17, 18, 18, 18, 17, 18, 
          18, 18, 17, 27, 33, 27, 27, 27, 27, 29, 33, 27, 27, 27, 29, 33, 
          27, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 
          70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 300, 300, 300, 300, 
          300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 
          300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 
          6, 6, 9, 6, 9, 6, 6, 6, 6, 6, 6, 5, 6, 6, 6, 6, 6, 6, 6, 6, 5, 
          5, 6, 6, 5, 5, 10, 10, 10, 14, 10, 11, 11, 10, 11, 14, 14, 10, 
          10, 11, 14, 10, 11, 18, 36, 36, 28, 29, 36, 28, 26, 28, 28, 29, 
          29, 36, 29, 36, 28, 29, 28, 28, 29, 28, 26, 36, 28, 28, 28, 29, 
          36, 36, 28, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 
          70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 
          70, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 
          300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 
          300, 300, 300, 300, 300),
  CosA = c(-0.037341918, -0.348272695, 
           0.351356897, -0.998677299, 0.992358148, -0.872325324, -0.693591239, 
           -0.87514132, 0.38509787, -0.593577988, -0.038306142, -0.435448029, 
           0.94046018, 0.416313831, 0.367319368, 0.0091734, 0.717185135, 
           0.488164093, -0.898681042, -0.072325775, 0.052991886, -0.38425023, 
           -0.047486253, -0.38425023, 0.220964119, 0.6669156, -0.855432677, 
           -0.830710311, -0.96188063, 0.525321989, 0.827293249, 0.897853465, 
           -0.946961422, 0.387626234, 0.645048605, -0.641449106, 0.367533535, 
           0.776357808, 0.137769033, 0.520138773, 0.914859717, -0.694605545, 
           -0.860873181, -0.041335527, -0.598460069, -0.275590247, -0.890072463, 
           -0.946961422, 0.714340466, 0.827293249, -0.244836059, 0.367319368, 
           -0.208908941, -0.833589455, -0.955214081, -0.979539818, 0.464263529, 
           0.522295737, 0.21661486, 0.993491935, -0.646720716, 0.992358148, 
           -0.607731072, 0.977329454, 0.864150985, 0.46576815, -0.226844365, 
           -0.899525797, -0.994208892, 0.987578598, 0.627744824, -0.58297784, 
           -0.574886754, 0.67956311, -0.87290906, 0.984381951, 0.950736909, 
           0.891970171, 0.697716767, -0.710051253, -0.93697683, 0.152208983, 
           -0.738045137, 0.628781304, 0.830446216, 0.993001597, 0.913269928, 
           0.636749629, -0.284337674, 0.794058755, -0.891415535, -0.87290906, 
           -0.546985963, 0.530290569, 0.966181065, -0.985009205, 0.092074723, 
           0.561503806, 0.075685503, 0.347540246, 0.673178842, -0.523144029, 
           -0.91352546, -0.309168727, 0.781514825, -0.985452292, -0.598460069, 
           -0.566978429, 0.783269824, -0.113552519, -0.996087835, -0.901331142, 
           0.426258136, -0.933249152, -0.344580036, -0.576039068, 0.650415905, 
           -0.183923624, 0.378799862, -0.678123935, -0.878981073, 0.059199185, 
           0.530485785, 0.910288998, -0.974645276, 0.137025046, 0.970719617, 
           -0.974908344, -0.598460069, -0.195787119, -0.749336836, 0.884828257, 
           -0.981786669, 0.897725494, -0.579538272, -0.082448798, 0.999365106, 
           0.6669156, 0.323043122, -0.693271271, 0.998921515, -0.514214753, 
           0.525191355, 0.992994475, -0.607731072, -0.996087835, 0.897853465, 
           0.181996734, 0.968840494, 0.227962848, 0.764319218, -0.946961422, 
           -0.825318594, 0.736865782, -0.818312568, 0.097014114, 0.904059259, 
           0.976237244, 0.624041971, 0.807105978, -0.988743615, 0.367319368, 
           0.790808346, 0.20496926, 0.374472781, 0.40089711, 0.169967143, 
           -0.344652092, -0.045038211, -0.502345222, -0.977274284, -0.065680488, 
           -0.986587573, 0.490941594, 0.792660359, 0.990029213, -0.898681042, 
           0.67956311, 0.997451461, 0.485247413, 1, 0.482070773, 0.85702297, 
           -0.977433228, 0.560705102, 0.912607671, 0.363256924, 0.301162447, 
           -0.672657714, 0.971653789, 0.999789455, 0.98284739, -0.593577988, 
           -0.423610457, 0.945390219, -0.962001977, 0.220739532, -0.98264916, 
           0.594920663, -0.999649491, -0.005727772, -0.326721918, -0.958950319, 
           0.170404743, 0.689498433, 0.601987833, -0.438313273, -0.552678082, 
           0.152133119, -0.433586469, -0.97757199, 0.348157045, -0.889464415, 
           -0.202599531, -0.480742095, -0.475792515, 0.996837096, -0.820603227, 
           -0.004011768, -0.642987199, 0.931950155, 0.669558567, 0.403883425, 
           0.867339329, -0.989462688, 0.449305876, 0.965971516, 0.485702755, 
           0.794784672, 0.075685503, 0.223919951, 0.717185135, 0.771762247, 
           -0.157579215, 0.990226704, 0.986449856, 0.999969739, 0.780587022, 
           -0.084065961, -0.773386107, -0.30733287, 0.367319368, 0.467799683, 
           -0.548407941, 0.30927039, 0.249540118, -0.322724006, -0.996087835, 
           0.94976867, -0.547665039, 0.016645336, 0.966181065, 0.936236303, 
           -0.642987199, -0.998763242, -0.730602327, -0.009647602, 0.024423284, 
           -0.745837608, 1, 0.827293249, 0.988222198, -0.876036458, -0.22041066, 
           0.729513932, -0.228782153, 0.999932456, 0.827293249, -0.122965129, 
           -0.098157207, -0.646720716, -0.029566684, -0.977180052, 0.203874447, 
           0.6669156, -0.237211328, -0.999641315, -0.64970559, -0.735041444, 
           -0.839994911, 0.999932456, -0.211229879, 0.426798645, 0.98843683, 
           -0.936456687, 0.367319368, 0.414767959, -0.518777858, -0.043417001, 
           -0.668317664, 0.882405097, -0.966551167, 0.994472432, 0.966181065, 
           -0.501842658, 0.814483264, -0.415269248, -0.574586162, -0.546113638, 
           -0.428362254, 0.863595917, -0.513203454, 0.945390219, -0.648692267, 
           0.367319368, -0.450263156, 0.675530893, 0.097014114, 0.946566954, 
           0.6669156, -0.986260767, 0.288138266, 0.998581911, 0.29076215, 
           -0.826070131, 0.899090642, 0.457359174, -0.970851824, -0.984546083, 
           0.045588626, -0.334338479, -0.513203454, 0.941811161, 0.525321989, 
           -0.979227506, 0.383528836, 0.285585779, -0.653191243, -0.220202108, 
           -0.529446679, -0.915741883, -0.008682728, -0.968498053, -0.994993487, 
           0.827086843, 0.124909991, 0.412941276, 0.997938156, 0.689232341, 
           -0.663450331, -0.598460069, -0.231524488, 0.997425186, -0.047486253, 
           0.876655719, 0.525321989, 0.924571028, 0.356484496, -0.99521294, 
           -0.996087835, -0.064641029, 0.133141029, 0.99830548, 0.981111354, 
           0.73931453, 0.026199028, 0.372967569, -0.99970581, 0.795230305, 
           0.99907097, 0.840177813, 1, 0.73931453, -0.873699645, 0.928169658, 
           -0.892323099, 0.996982652, -0.108986752, -0.578452059, 0.789400258, 
           -0.681974644, 0.673178842, -0.685060053, 0.055209026, 0.285013021, 
           0.748575768, -0.966817805, -0.946126698, -0.914308778, -0.040601503, 
           -0.883081283, -0.777457221, -0.396585815, 0.071180161, -0.873699645, 
           0.468584482, 0.714340466, 0.846310221, 0.933924004, -0.536340424, 
           0.270065249, -0.621345814, -0.999174807, -0.93961405, -0.999974425, 
           0.785198565, 0.964478173, -0.308250942, -0.842041477, -0.284836974, 
           -0.273027982, -0.718091932, -0.65251848, -0.587126183, -0.133687085, 
           -0.812220294, -0.780797729, 0.617245702, 0.577702742, 0.380103479, 
           0.879353351, 0.294086083, -0.06545071, 0.955227874, -0.856888753, 
           0.40307077, 0.133141029, 0.067636103, -0.884814211, -0.307259826, 
           0.897853465, -0.593577988, 0.35987308, -0.21311577, 0.367319368, 
           0.388924682, -0.891214197, -0.61652295, 0.705735531, -0.995644284, 
           -0.184586431, -0.72933579, -0.28604022, -0.989462688, -0.417024037, 
           -0.448073616, -0.456664278, 0.946522747, -0.580748437, -0.536340424, 
           0.665087527, 0.880829297, -0.581894898, 0.988222198, -0.040968518, 
           -0.859928824, -0.999947362, -0.273381328, -0.184586431, -0.999498566, 
           0.972953012, -0.989612973, -0.859928824, -0.439648215, -0.224024137, 
           -0.773386107, -0.999573163, -0.556373547, -0.26203493, -0.915741883, 
           -0.873699645, 0.476156553, 0.143848186, 0.806717385, 0.977361945, 
           0.961156885, -0.828727308, -0.960614081, 0.673892063, 1, 0.750339784, 
           0.695431361, 0.743937366, 0.603282852, 0.879353351, -0.705920006, 
           -0.404527806, -0.503311978, 0.952627482, 0.867118218, 0.8618688, 
           0.356484496, -0.845697828, 0.899445546, -0.855432677, 0.961156885, 
           0.012725813, 0.781514825, -0.043783972, -0.187565272, 0.017242845, 
           0.867339329, 0.572792189, -0.026536087, 0.129466975, -0.076907264, 
           0.722584852, 0.689442836, -0.852196243, 0.316586353, -0.996606707, 
           -0.448073616, 0.99473463, 0.984500444, -0.503311978, 0.408892739, 
           -0.956866674, -0.985628792, 0.356484496, 1, -0.803574817, -0.773386107, 
           -0.997600027, 0.010352063, 0.938429223, -0.933249152, -0.773386107, 
           -0.224024137, -0.725268331, 0.139891908, -0.808135697, 0.125943438, 
           -0.4675695, 0.98457823, -0.283486064, -0.21571827, -0.284763395, 
           0.717548, -0.646720716, 0.999338662, 0.98457823, -0.374033021, 
           0.971653789, -0.392096809, 0.905571969, -0.147181293, 0.133141029, 
           0.129102737, 0.171792959, 0.999338662, -0.988743615, 0.131896625, 
           0.99907097, -0.168397448, 0.649286643, 0.190001473, 0.016645336, 
           0.633662809, 0.951243803, -0.051111223, 0.933924004, -0.737693601, 
           -0.784809687, -0.80331042, 0.94589835, -0.272173462, -0.396585815, 
           0.209747945, -0.159046229, 0.840177813, -0.93961405, -0.495031807, 
           0.294510495, 0.829908276, -0.961859636, -0.045038211, 0.670490557, 
           -0.888784438, 0.90316686, 0.031679183, -0.943751427, -0.297304396, 
           0.670490557, 0.662372853, 0.525321989, -0.998759423, -0.392096809, 
           -0.773386107, 0.63475219, 0.853260138, 0.076647615, -0.933249152, 
           -0.692575556, 0.861643509, 0.661982565, -0.565148023, 0.372967569, 
           -0.025127564, -0.970870218, -0.999262529, 0.570480013, 0.223919951, 
           0.887778461, 0.951630292, -0.436247388, -0.798920095, -0.122965129, 
           -0.187129056, 0.620157341, -0.141908321, -0.344235188, -0.171098894, 
           0.832996922, -0.95127677, 0.886414471, -0.680136044, 0.923493678, 
           -0.848529661, -0.961859636, -0.49142153, 0.998776156, -0.692895822, 
           -0.955675286, -0.946557232, -0.787101126, -0.883741534, -0.991168311, 
           -0.996606707, -0.907896602, -0.874346957, 0.203799301, 0.99906766, 
           -0.693271271, -0.842041477, -0.971170273, -0.728119364, -0.047853156, 
           -0.546985963, -0.5800877, -0.459101264, -0.010014905, 0.98843683, 
           0.429469152),
  Slope = c(15, 16, 6, 10, 10, 13, 16, 5, 6, 7, 20, 
            12, 12, 7, 4, 15, 5, 11, 3, 11, 6, 20, 11, 5, 11, 14, 2, 14, 
            10, 7, 4, 29, 3, 11, 4, 32, 12, 11, 9, 14, 4, 15, 20, 10, 9, 
            9, 3, 12, 4, 5, 6, 9, 21, 5, 9, 13, 32, 29, 6, 6, 14, 15, 8, 
            5, 26, 27, 19, 24, 6, 16, 14, 8, 36, 12, 20, 7, 11, 9, 15, 15, 
            15, 12, 6, 10, 14, 33, 1, 11, 13, 8, 11, 21, 18, 25, 28, 24, 
            10, 8, 8, 18, 9, 21, 14, 10, 10, 21, 0, 23, 12, 29, 20, 9, 14, 
            13, 29, 23, 11, 11, 11, 34, 15, 10, 5, 10, 11, 1, 9, 11, 10, 
            4, 30, 30, 12, 25, 9, 28, 12, 13, 19, 10, 16, 9, 21, 10, 2, 1, 
            10, 12, 7, 6, 5, 4, 4, 11, 14, 5, 11, 10, 12, 13, 1, 7, 11, 18, 
            16, 8, 23, 5, 6, 2, 16, 28, 6, 20, 19, 12, 12, 6, 17, 22, 10, 
            20, 6, 23, 15, 4, 15, 14, 11, 14, 11, 18, 16, 17, 4, 8, 8, 13, 
            28, 13, 21, 18, 35, 21, 20, 15, 32, 14, 18, 16, 20, 28, 19, 14, 
            15, 25, 29, 20, 17, 3, 9, 16, 25, 5, 7, 22, 18, 19, 3, 11, 10, 
            11, 14, 7, 7, 17, 15, 18, 13, 12, 15, 9, 27, 7, 6, 16, 8, 3, 
            12, 9, 10, 13, 15, 8, 8, 14, 16, 22, 14, 4, 2, 9, 12, 8, 9, 10, 
            14, 6, 8, 8, 2, 24, 14, 18, 1, 13, 4, 6, 22, 20, 2, 13, 9, 4, 
            14, 3, 12, 12, 5, 12, 12, 9, 8, 9, 14, 16, 5, 18, 16, 4, 12, 
            9, 8, 12, 6, 9, 6, 5, 14, 8, 11, 18, 5, 18, 15, 18, 30, 4, 9, 
            8, 26, 2, 27, 0, 16, 14, 25, 5, 8, 27, 10, 7, 11, 3, 19, 25, 
            20, 5, 19, 4, 5, 5, 11, 4, 4, 8, 19, 2, 12, 2, 33, 6, 26, 0, 
            2, 7, 7, 5, 8, 6, 4, 8, 7, 3, 20, 7, 17, 14, 5, 10, 11, 18, 22, 
            20, 16, 14, 12, 12, 5, 16, 24, 17, 4, 7, 2, 8, 2, 2, 6, 6, 4, 
            20, 9, 4, 14, 7, 17, 13, 3, 6, 8, 14, 14, 9, 13, 19, 10, 12, 
            18, 16, 13, 7, 11, 5, 9, 6, 2, 21, 17, 14, 2, 5, 14, 7, 8, 9, 
            16, 14, 17, 9, 5, 6, 12, 3, 8, 9, 12, 7, 6, 6, 9, 27, 15, 13, 
            5, 18, 24, 19, 16, 13, 17, 17, 9, 17, 20, 10, 25, 23, 17, 15, 
            6, 18, 32, 31, 19, 15, 10, 8, 23, 13, 18, 23, 8, 13, 13, 33, 
            18, 4, 19, 18, 18, 4, 16, 11, 5, 12, 5, 10, 34, 22, 10, 14, 15, 
            14, 29, 25, 8, 20, 17, 7, 3, 23, 3, 9, 4, 20, 22, 14, 2, 24, 
            27, 29, 16, 18, 17, 3, 15, 7, 17, 19, 12, 19, 27, 15, 18, 21, 
            15, 5, 6, 4, 15, 20, 1, 9, 14, 10, 5, 15, 13, 8, 2, 14, 6, 13, 
            32, 26, 5, 18, 26, 15, 17, 8, 18, 11, 10, 38, 7, 17, 10, 12, 
            9, 7, 11, 17, 14, 30, 10, 13, 9, 13, 23, 30, 10, 13, 1, 22, 1, 
            12, 22, 9, 8, 15, 29, 11, 10, 22, 19, 34, 14, 21, 7, 13, 23, 
            41, 33, 14, 38, 37, 14, 10, 15, 16, 8, 18, 5, 32, 20, 9, 28, 
            18, 18, 16, 25, 25, 9, 24, 17, 13, 7, 12, 19, 25, 14, 3, 4, 16, 
            22, 24, 14, 21, 18, 21, 23),
  CF = c(0, 0, 0, 1, 1, 0, 1, 0, 0, 
         0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 1, 0, 
         0, 0, 1, 0, 0, 0, 1, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 
         1, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 
         0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 
         0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
         1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 1, 0, 0, 
         0, 1, 1, 0, 0, 0, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 
         1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 
         1, 1, 1, 1, 1, 1, 0, 0, 1, 1, 0, 1, 1, 1, 0, 0, 1, 0, 1, 1, 0, 
         0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 
         1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
         0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 
         0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 
         0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 
         1, 1, 1, 1, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
         0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 
         0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 
         0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 1, 1, 1, 1, 
         0, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 
         1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 1, 1, 0, 0, 
         1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 
         1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 
         0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 
         0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 
         0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 1, 1, 1, 0, 1, 
         1, 1, 1, 1, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 
         1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 
         0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
         0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 
         0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0))
```

```{r packages}
library(greta)
```

```{r model}
# centre the slope variable
data$SlopeC <- data$Slope - mean(data$Slope)

# transform the Age variable
data$AgeTrans <- 1 / (data$Age / 100) - 1 / 0.2

# centre and scale the coordinates, retaining the aspect ratio
data$Xs <- scale(data$X, scale = FALSE)
data$Ys <- scale(data$Y, scale = FALSE)
scale <- sd(data$Xs)
data$Xs <- data$Xs / scale
data$Ys <- data$Ys / scale

# linear predictor parameters
aa  <- normal(0, 1000)
b <- normal(0, 1000, dim = 5)

# make design matrix
X <- cbind(data$AgeTrans,
           data$AgeTrans ^ 2,
           data$SlopeC,
           data$CosA,
           data$SlopeC * data$CosA)

# linear predictor
mu <- aa + X %*% b

# distance matrices
coords <- cbind(data$Xs, data$Y)
dist_KE <- as.matrix(dist(coords[1:114, ]))
dist_PP <- as.matrix(dist(coords[115:633, ]))

# spatial covariance matrices
rescaling <- max(data$Xs) / max(data$X)
phi <- 1 / uniform(0, 5)
covar_KE <- exp(-phi * dist_KE)
covar_PP <- exp(-phi * dist_PP)

z_KE <- multivariate_normal(zeros(ncol(covar_KE)),
                            covar_KE)
z_PP <- multivariate_normal(zeros(ncol(covar_KE)),
                            covar_PP)

# # function to define a spatial random effect, specified by a given covariance
# # function, using the whitening transformation
# gp <- function (covar) {
#   n <- ncol(covar)
#   z <- normal(0, 1, dim = n)
#   U <- chol(covar)
#   U %*% z
# }
# 
# # spatially-correlated random variables
# z_KE <- gp(covar_KE)
# z_PP <- gp(covar_PP)
z <- c(z_KE, z_PP)

# likelihood
prob <- iprobit(mu + z)
distribution(data$CF) <- bernoulli(prob)
```

```{r fit}
m <- model(aa, b, phi)
draws <- mcmc(m, sampler = rwmh(), warmup = 10000, n_samples = 30000)
```

```{r plot}
plot(draws)
summary(draws)
```




